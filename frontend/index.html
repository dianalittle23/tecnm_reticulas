<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TECNM Retículas - Frontend Tester</title>
    
    <!-- Carga de Tailwind CSS para el diseño -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Carga de AXIOS CDN (¡Nuevo paso clave!) -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f4f5;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-2xl bg-white shadow-xl rounded-xl p-8 space-y-6">
        <h1 class="text-3xl font-bold text-gray-800 border-b pb-3 mb-6">
            Conexión Frontend ↔ Backend (Usando Axios)
        </h1>

        <!-- Muestra la URL del Backend -->
        <div class="bg-indigo-50 p-4 rounded-lg">
            <p class="text-sm font-medium text-indigo-700">URL del Backend (API):</p>
            <code id="backend-url" class="block mt-1 font-mono text-base text-indigo-900 break-all bg-indigo-100 p-2 rounded">
                <!-- Se llena con JS -->
            </code>
        </div>
        
        <!-- Sección de resultados de la conexión -->
        <div class="space-y-4">
            <h2 class="text-2xl font-semibold text-gray-700">Resultado de la Prueba de Conexión</h2>
            
            <button id="test-button" 
                    class="w-full px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-300 transform hover:scale-[1.01] focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-opacity-50"
                    onclick="testConnection()">
                Probar Conexión con Backend
            </button>

            <!-- Indicador de carga -->
            <div id="loading-indicator" class="hidden text-center">
                <p class="text-indigo-500 font-medium flex items-center justify-center">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-indigo-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Conectando con Axios...
                </p>
            </div>
            
            <!-- Contenedor para mostrar el resultado de la API -->
            <div id="api-result" class="p-4 rounded-lg text-sm font-mono whitespace-pre-wrap">
                <!-- Los resultados de la API se mostrarán aquí -->
            </div>
        </div>

    </div>

    <script>
        // *** 1. CONFIGURA TU URL DEL BACKEND AQUÍ ***
        // Reemplaza esta URL con tu dominio de Railway (ej: tecnmreticulas-production.up.railway.app)
        const BACKEND_URL = "https://tecnmreticulas-production.up.railway.app";
        // Llamaremos a tu endpoint raíz
        const API_ENDPOINT = BACKEND_URL + "/api-status"; 

        document.getElementById('backend-url').textContent = API_ENDPOINT;

        async function testConnection() {
            const resultDiv = document.getElementById('api-result');
            const loading = document.getElementById('loading-indicator');
            const button = document.getElementById('test-button');
            
            resultDiv.innerHTML = '';
            resultDiv.className = 'p-4 rounded-lg text-sm font-mono whitespace-pre-wrap';
            loading.classList.remove('hidden');
            button.disabled = true;

            try {
                // USO DE AXIOS
                // ----------------------------------------------------
                // Axios automáticamente lanza un error para códigos de estado 4xx/5xx,
                // lo que simplifica el manejo de errores.
                const response = await axios.get(API_ENDPOINT);

                // La respuesta de texto está en response.data para Axios (en lugar de .text() en fetch)
                const data = response.data;
                // ----------------------------------------------------
                
                resultDiv.classList.add('bg-green-100', 'border', 'border-green-400', 'text-green-800');
                resultDiv.innerHTML = `
                    <p class="font-bold">✅ Conexión Exitosa (Status ${response.status} OK)</p>
                    <hr class="my-2 border-green-300">
                    <p>Respuesta de la API:</p>
                    <p class="mt-1">${data}</p>
                `;

            } catch (error) {
                console.error("Error al conectar:", error);
                
                let errorMessage = "No se pudo conectar al servidor.";
                if (error.response) {
                    // El servidor respondió con un código de estado (ej. 404, 500)
                    errorMessage = `Error HTTP ${error.response.status}: ${error.response.statusText}`;
                } else if (error.request) {
                    // La petición fue hecha pero no se recibió respuesta (ej. CORS o servidor caído)
                    errorMessage = "No se recibió respuesta del servidor. Revisa CORS o la URL.";
                } else {
                    // Error al configurar la petición
                    errorMessage = error.message;
                }

                resultDiv.classList.add('bg-red-100', 'border', 'border-red-400', 'text-red-800');
                resultDiv.innerHTML = `
                    <p class="font-bold">❌ Error de Conexión</p>
                    <hr class="my-2 border-red-300">
                    <p>Detalle del Error:</p>
                    <p class="mt-1">${errorMessage}</p>
                    <p class="mt-3 text-xs">Revisa la consola para más detalles. Si es un error de CORS, necesitas configurar el encabezado de tu servidor.</p>
                `;
            } finally {
                loading.classList.add('hidden');
                button.disabled = false;
            }
        }
    </script>
</body>
</html>
